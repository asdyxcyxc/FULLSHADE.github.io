---
layout: single
title: CVE-2020-5509 - Remote Authenticated Remote code execution in Car Rental Project v.1.0 - arbitrary file upload
---

The Car Rental Project v.1.0 web application is a piece of software produced by PhpGuruKul with over **24,944 downloads**. It's advertised as an easy to deploy a web application for small companies to utilize for setting up a car purchase/rental shop. Searching Google via various google dorks results in the discovery of a small handful of active deployments.

----

```c
# Exploit Title: Car Rental Project v.1.0 Remote Code Execution
# Google Dork: N/A
# Date: 1/3/2020
# Exploit Author: FULLSHADE
# Vendor Homepage: https://phpgurukul.com/
# Software Link: https://phpgurukul.com/car-rental-project-php-mysql-free-download/
# Version: 1.0
# Tested on: Windows
# CVE : CVE-2020-5509
```

**The vulnerability & code**

Within the administrator settings portal, an admin can update various product information, an admin can change the images of one of the products to a malicious payload since the server-side PHP code doesn't serve proper validation for the types of code and files which are uploaded. Without proper sanitization, the web application becomes vulnerable to what's classed as Arbitrary File Upload which can result in remote code execution in this specific instance.

Since the web-application is free and open-source, we can view the vulnerable source code which is located in changeimage1.php

```php
if(isset($_POST['update']))
{
$vimage1=$_FILES["img1"]["name"];
$id=intval($_GET['imgid']);
move_uploaded_file($_FILES["img1"]["tmp_name"],"img/vehicleimages/".$_FILES["img1"]["name"]);
$sql="update tblvehicles set Vimage1=:vimage1 where id=:id";
$query = $dbh->prepare($sql);
$query->bindParam(':vimage1',$vimage1,PDO::PARAM_STR);
$query->bindParam(':id',$id,PDO::PARAM_STR);
$query->execute();

$msg="Image updated successfully";
```

An attacker can make a post request to the changeimage1.php page with any sort of malicious file since there is no file sanitization or checking to see if the uploaded "image" is an image. This is a horrible example of how proper file upload should be handled from the server-side PHP code.
On the 5th line, you can see that the "image" payload is uploaded to `img/vehicleimages/` which is also an open directory with a default installation of this product.

----

**Manual POC -> code execution**


1. Visit carrental > admin login > changeimage1.php

![image of upload](https://raw.githubusercontent.com/FULLSHADE/FULLSHADE.github.io/master/assets/admin22.png)

2. Upload a php rce vulnerable payload
3. Visit `/carrentalproject/carrental/admin/img/vehicleimages/<RCE>.php` to visit your file
4. Execute commands on the server/reverse shell
  
![image of shell](https://raw.githubusercontent.com/FULLSHADE/FULLSHADE.github.io/master/assets/ncc1c.png)

----

**Automated exploitation**

In Python, we can use the default admin credentials for the application to log in, then use Pythons request module to grab the session token and use that to upload your payload to the open directory, then you can make GET requests to the backdoor PHP file to execute arbitrary commands on the remote server.

![image of RCE](https://raw.githubusercontent.com/FULLSHADE/CVE-2020-5509-POC/master/poc-rce.png)

https://packetstormsecurity.com/files/155925/Car-Rental-Project-1.0-Remote-Code-Execution.html

----

**Recommended vendor patch/fix**

Any vendor that is running this software should either patch the code themselves manually (since the original company/author acknowledge yet decided against fixing it) or to remove the software web application entirely.

----

**Make it Unauthenticated**

To make this CVE/vulnerability become double as dangerous, another CVE was discovered within this same vulnerability assessment, which is an Unauthenticated SQL injection, an attacker can leverage this SQL injection to modify the user database and add/change the current administrative password to give an attacker full authenticated remote code execution.

----

**Disclosure**

1. Contacted the vendor/company
2. I found a posting where the author acknowledged the vulnerability yet didn't care to patch it.
3. The author didn't respond after 60 days.
4. Full disclosure of POC exploit

----

**Conclusion**

Conclusively, an RCE vulnerability was discovered in a car rental web application (which has live and active deployments), an attacker can upload malicious files without needing to bypass any sort of file sanitization or validation. An attacker can use this vulnerability to upload malware and or backdoors to the server which leads to full compromise.
